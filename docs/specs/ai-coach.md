# SPEC: VITRÃšVIO - VITRU IA (v2.0)

## Documento de EspecificaÃ§Ã£o do VITRÃšVIO

**VersÃ£o:** 2.0  
**Data:** Fevereiro 2026  
**Projeto:** VITRU IA (A MatemÃ¡tica do FÃ­sico Perfeito)

---

## 1. VISÃƒO GERAL

O **VITRÃšVIO** Ã© o diferencial competitivo do VITRU IA. NÃ£o somos apenas uma calculadora de proporÃ§Ãµes - somos um **coach virtual inteligente** que analisa, orienta e motiva o atleta em sua jornada para o fÃ­sico ideal.

### 1.0 Origem do Nome

> **VITRÃšVIO** Ã© inspirado em **Marcus Vitruvius Pollio**, o arquiteto romano do sÃ©culo I a.C. que definiu as proporÃ§Ãµes ideais do corpo humano em sua obra "De Architectura". Seus estudos sobre simetria e proporÃ§Ã£o inspiraram Leonardo da Vinci a criar o icÃ´nico **Homem Vitruviano** - a representaÃ§Ã£o perfeita das proporÃ§Ãµes humanas que fundamenta toda a filosofia do VITRU IA.

### 1.1 MissÃ£o do VITRÃšVIO

> "Transformar dados em planos de aÃ§Ã£o personalizados que ajudem o atleta a entender seu corpo, otimizar seu treino e dieta, e atingir seu fÃ­sico ideal da forma mais eficiente possÃ­vel."

### 1.2 PrincÃ­pios do VITRÃšVIO

| PrincÃ­pio | DescriÃ§Ã£o |
|-----------|-----------|
| **Personalizado** | Cada anÃ¡lise considera o contexto completo do usuÃ¡rio |
| **AcionÃ¡vel** | Sempre gera planos concretos de treino e dieta |
| **Seguro** | Considera saÃºde, lesÃµes e medicamentos |
| **Motivador** | Celebra vitÃ³rias, mesmo pequenas |
| **Honesto** | Aponta problemas sem ser desmotivador |
| **Educativo** | Explica o "porquÃª" das recomendaÃ§Ãµes |
| **Contextual** | Considera histÃ³rico, metas, rotina e limitaÃ§Ãµes |

### 1.3 Capacidades do VITRÃšVIO (v2.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VITRÃšVIO v2.0                           â”‚
â”‚                    Coach IA do VITRU IA                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“Š ANÃLISE           ğŸ“ˆ EVOLUÃ‡ÃƒO          ğŸ¯ RECOMENDAÃ‡Ã•ES     â”‚
â”‚  â€¢ ProporÃ§Ãµes         â€¢ TendÃªncias         â€¢ Treino            â”‚
â”‚  â€¢ Simetria           â€¢ Comparativos       â€¢ Dieta             â”‚
â”‚  â€¢ EstÃ©tica           â€¢ ProjeÃ§Ãµes          â€¢ Prioridades       â”‚
â”‚  â€¢ DiagnÃ³stico        â€¢ Marcos             â€¢ Metas             â”‚
â”‚                                                                 â”‚
â”‚  ğŸ‹ï¸ PLANO DE TREINO   ğŸ¥— PLANO ALIMENTAR   ğŸ‘¤ CONTEXTO RICO    â”‚
â”‚  â€¢ DivisÃ£o semanal    â€¢ Calorias/macros    â€¢ SaÃºde/lesÃµes      â”‚
â”‚  â€¢ ExercÃ­cios foco    â€¢ RefeiÃ§Ãµes          â€¢ Medicamentos      â”‚
â”‚  â€¢ CorreÃ§Ã£o simetria  â€¢ Timing nutrientes  â€¢ Rotina de vida    â”‚
â”‚  â€¢ ProgressÃ£o         â€¢ SuplementaÃ§Ã£o      â€¢ Disponibilidade   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¬ COMUNICAÃ‡ÃƒO       ğŸ† MOTIVAÃ‡ÃƒO         âš ï¸ ALERTAS          â”‚
â”‚  â€¢ Insights diÃ¡rios   â€¢ Conquistas         â€¢ Assimetrias       â”‚
â”‚  â€¢ RelatÃ³rios         â€¢ Streaks            â€¢ RegressÃµes        â”‚
â”‚  â€¢ Chat interativo    â€¢ CelebraÃ§Ãµes        â€¢ SaÃºde/seguranÃ§a   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 Fluxo Principal (NOVO)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JORNADA COMPLETA DO USUÃRIO                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ï¸âƒ£ ONBOARDING COMPLETO                                         â”‚
â”‚     â””â”€â–¶ Coleta contexto rico (saÃºde, vida, objetivos)          â”‚
â”‚                              â–¼                                  â”‚
â”‚  2ï¸âƒ£ AVALIAÃ‡ÃƒO IA                                                â”‚
â”‚     â””â”€â–¶ UsuÃ¡rio insere medidas corporais                       â”‚
â”‚                              â–¼                                  â”‚
â”‚  3ï¸âƒ£ RESULTADOS                                                  â”‚
â”‚     â””â”€â–¶ Scores, proporÃ§Ãµes, simetria, diagnÃ³stico              â”‚
â”‚                              â–¼                                  â”‚
â”‚  4ï¸âƒ£ VITRÃšVIO PROCESSA                                           â”‚
â”‚     â””â”€â–¶ Cruza resultados + contexto completo                   â”‚
â”‚                              â–¼                                  â”‚
â”‚  5ï¸âƒ£ PLANO PERSONALIZADO                                         â”‚
â”‚     â””â”€â–¶ Treino especÃ­fico + Dieta especÃ­fica + Timeline        â”‚
â”‚                              â–¼                                  â”‚
â”‚  6ï¸âƒ£ ACOMPANHAMENTO                                              â”‚
â”‚     â””â”€â–¶ Insights diÃ¡rios, ajustes, reavaliaÃ§Ãµes               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. PERFIL COMPLETO DO USUÃRIO (NOVO)

### 2.1 UserHealthProfile

O VITRÃšVIO precisa de um contexto rico para gerar recomendaÃ§Ãµes precisas e seguras.

```typescript
interface UserHealthProfile {
  // ============================================
  // DADOS BÃSICOS
  // ============================================
  idade: number
  genero: 'masculino' | 'feminino' | 'outro'
  altura: number                      // cm
  pesoAtual: number                   // kg
  
  // ============================================
  // COMPOSIÃ‡ÃƒO CORPORAL
  // ============================================
  gorduraCorporal?: number            // %
  pesoMeta?: number                   // kg
  massaMagra?: number                 // kg (calculado)
  
  // ============================================
  // PERFIL DE VIDA
  // ============================================
  profissao: string                   // "Programador", "Pedreiro", etc
  rotinaDiaria: RotinaDiaria          // NÃ­vel de atividade no trabalho
  horasSono: number                   // MÃ©dia por noite
  qualidadeSono: 'ruim' | 'regular' | 'boa' | 'excelente'
  nivelEstresse: NivelEstresse
  horasTrabalho: number               // Horas por dia
  trabalhoFisico: boolean             // Se trabalho envolve esforÃ§o fÃ­sico
  
  // ============================================
  // SAÃšDE E CONDIÃ‡Ã•ES MÃ‰DICAS
  // ============================================
  condicoesSaude: CondicaoSaude[]
  lesoes: Lesao[]
  alergias: string[]
  restricoesMovimento: string[]       // "NÃ£o pode fazer supino", etc
  
  // ============================================
  // FÃRMACOS E SUPLEMENTOS
  // ============================================
  medicamentos: Medicamento[]
  suplementos: Suplemento[]
  usaEsteroides: boolean
  trt: boolean                        // Terapia de reposiÃ§Ã£o de testosterona
  esteroidesDetalhes?: string         // Confidencial
  
  // ============================================
  // EXPERIÃŠNCIA DE TREINO
  // ============================================
  tempoTreinando: ExperienciaTreino
  frequenciaTreinoAtual: number       // Dias por semana atual
  frequenciaTreinoDesejada: number    // Dias que quer/pode treinar
  duracaoTreinoMax: number            // Minutos mÃ¡ximo por sessÃ£o
  localTreino: LocalTreino
  equipamentosDisponiveis: string[]   // Lista de equipamentos
  treinoAtual?: string                // DescriÃ§Ã£o do treino atual
  
  // ============================================
  // PREFERÃŠNCIAS ALIMENTARES
  // ============================================
  dietaAtual: TipoDieta
  refeicoesdia: number                // Quantas refeiÃ§Ãµes faz/quer fazer
  cozinha: boolean                    // Sabe/pode cozinhar
  tempoPreparoRefeicao: number        // Minutos disponÃ­veis
  orcamentoAlimentacao: Orcamento
  alimentosEvitar: string[]           // NÃ£o gosta ou nÃ£o pode
  alimentosPreferidos: string[]       // Prefere comer
  fazJejum: boolean
  horarioJejum?: string               // "16:8", "20:4", etc
  
  // ============================================
  // OBJETIVOS
  // ============================================
  objetivoPrincipal: ObjetivoPrincipal
  objetivoEspecifico: string          // Texto livre
  prazo: PrazoObjetivo
  prioridades: string[]               // ["Aumentar ombros", "Reduzir cintura"]
  competicao: boolean                 // Pretende competir?
  categoriaInteresse?: string         // "Classic Physique", "Men's Physique"
  
  // ============================================
  // DISPONIBILIDADE
  // ============================================
  diasDisponiveisTreino: DiaSemana[]
  horarioPreferido: HorarioTreino
  tempoMaximoTreino: number           // Minutos
  treinarEmCasa: boolean              // Pode/quer treinar em casa tambÃ©m
  
  // ============================================
  // HISTÃ“RICO
  // ============================================
  pesoMaximoHistorico?: number
  pesoMinimoHistorico?: number
  melhorFormaFisica?: string          // DescriÃ§Ã£o de quando estava melhor
  tentativasAnteriores?: string       // O que jÃ¡ tentou e nÃ£o funcionou
}
```

### 2.2 Tipos Auxiliares

```typescript
// Enums de Rotina
enum RotinaDiaria {
  SEDENTARIA = 'sedentaria',          // Trabalho sentado, pouco movimento
  LEVE = 'leve',                      // Trabalho sentado, caminha Ã s vezes
  MODERADA = 'moderada',              // Trabalho em pÃ©, movimento moderado
  ATIVA = 'ativa',                    // Trabalho fÃ­sico leve
  MUITO_ATIVA = 'muito_ativa'         // Trabalho fÃ­sico intenso
}

enum NivelEstresse {
  BAIXO = 'baixo',
  MODERADO = 'moderado',
  ALTO = 'alto',
  MUITO_ALTO = 'muito_alto'
}

// SaÃºde
interface CondicaoSaude {
  nome: string                        // "Diabetes tipo 2"
  severidade: 'leve' | 'moderada' | 'grave'
  controlada: boolean
  medicacao?: string                  // Medicamento usado
  observacoes?: string
}

interface Lesao {
  local: string                       // "Ombro esquerdo"
  tipo: string                        // "Tendinite"
  dataOcorrencia?: Date
  recuperada: boolean
  restricoes: string[]                // ["Evitar press acima da cabeÃ§a"]
  observacoes?: string
}

interface Medicamento {
  nome: string                        // "Losartana"
  principioAtivo?: string             // "Losartana potÃ¡ssica"
  dosagem: string                     // "50mg"
  frequencia: string                  // "1x ao dia"
  horario?: string                    // "ManhÃ£"
  motivo: string                      // "PressÃ£o alta"
  efeitosColaterais?: string[]        // Efeitos que o usuÃ¡rio sente
}

interface Suplemento {
  nome: string                        // "Whey Protein"
  marca?: string
  dosagem: string                     // "30g"
  frequencia: string                  // "PÃ³s-treino"
  objetivo: string                    // "Aumento de proteÃ­na"
}

// Treino
enum ExperienciaTreino {
  INICIANTE = 'iniciante',            // < 1 ano
  INTERMEDIARIO = 'intermediario',    // 1-3 anos
  AVANCADO = 'avancado',              // 3-5 anos
  EXPERIENTE = 'experiente',          // 5-10 anos
  VETERANO = 'veterano'               // 10+ anos
}

enum LocalTreino {
  ACADEMIA_COMPLETA = 'academia_completa',
  ACADEMIA_SIMPLES = 'academia_simples',
  HOME_GYM = 'home_gym',
  CASA_BASICO = 'casa_basico',        // SÃ³ peso corporal / elÃ¡sticos
  MISTO = 'misto'
}

// AlimentaÃ§Ã£o
enum TipoDieta {
  SEM_RESTRICAO = 'sem_restricao',
  VEGETARIANA = 'vegetariana',
  VEGANA = 'vegana',
  PESCETARIANA = 'pescetariana',
  LOW_CARB = 'low_carb',
  CETOGENICA = 'cetogenica',
  MEDITERRANEA = 'mediterranea',
  FLEXIVEL = 'flexivel',              // IIFYM
  OUTRA = 'outra'
}

enum Orcamento {
  BAIXO = 'baixo',                    // Precisa economizar
  MODERADO = 'moderado',              // Normal
  ALTO = 'alto',                      // Pode investir mais
  SEM_LIMITE = 'sem_limite'           // OrÃ§amento nÃ£o Ã© problema
}

// Objetivos
enum ObjetivoPrincipal {
  ESTETICA = 'estetica',              // Melhorar aparÃªncia
  HIPERTROFIA = 'hipertrofia',        // Ganhar massa muscular
  DEFINICAO = 'definicao',            // Perder gordura mantendo mÃºsculo
  RECOMPOSICAO = 'recomposicao',      // Perder gordura e ganhar mÃºsculo
  FORCA = 'forca',                    // Ficar mais forte
  SAUDE = 'saude',                    // Melhorar saÃºde geral
  COMPETICAO = 'competicao',          // Preparar para competiÃ§Ã£o
  MANUTENCAO = 'manutencao'           // Manter fÃ­sico atual
}

enum PrazoObjetivo {
  CURTO = '3meses',
  MEDIO = '6meses',
  LONGO = '1ano',
  MUITO_LONGO = '2anos',
  SEM_PRAZO = 'sem_prazo'
}

enum HorarioTreino {
  MANHA_CEDO = 'manha_cedo',          // 5h-7h
  MANHA = 'manha',                    // 7h-11h
  ALMOCO = 'almoco',                  // 11h-14h
  TARDE = 'tarde',                    // 14h-18h
  NOITE = 'noite',                    // 18h-22h
  MADRUGADA = 'madrugada',            // 22h-5h
  FLEXIVEL = 'flexivel'
}

type DiaSemana = 'segunda' | 'terca' | 'quarta' | 'quinta' | 'sexta' | 'sabado' | 'domingo'
```

### 2.3 Schema Prisma (AdiÃ§Ãµes)

```prisma
// ============================================
// PROFILE (Expandido)
// ============================================

model Profile {
  id              String   @id @default(cuid())
  userId          String   @unique
  
  // Dados BÃ¡sicos (existente)
  birthDate       DateTime?
  gender          Gender   @default(MALE)
  altura          Float?
  punho           Float?
  tornozelo       Float?
  joelho          Float?
  pelve           Float?
  
  // NOVO: Perfil de Vida
  profissao           String?
  rotinaDiaria        RotinaDiaria?
  horasSono           Float?
  qualidadeSono       QualidadeSono?
  nivelEstresse       NivelEstresse?
  horasTrabalho       Float?
  trabalhoFisico      Boolean   @default(false)
  
  // NOVO: ExperiÃªncia de Treino
  tempoTreinando          ExperienciaTreino?
  frequenciaTreinoAtual   Int?
  frequenciaTreinoDesejada Int?
  duracaoTreinoMax        Int?
  localTreino             LocalTreino?
  equipamentos            String[]
  treinoAtual             String?
  
  // NOVO: AlimentaÃ§Ã£o
  dietaAtual              TipoDieta?
  refeicoesdia            Int?
  cozinha                 Boolean?
  tempoPreparoRefeicao    Int?
  orcamentoAlimentacao    Orcamento?
  alimentosEvitar         String[]
  alimentosPreferidos     String[]
  fazJejum                Boolean   @default(false)
  horarioJejum            String?
  
  // NOVO: Objetivos
  objetivoPrincipal       ObjetivoPrincipal?
  objetivoEspecifico      String?
  prazo                   PrazoObjetivo?
  prioridades             String[]
  competicao              Boolean   @default(false)
  categoriaInteresse      String?
  
  // NOVO: Disponibilidade
  diasDisponiveisTreino   String[]
  horarioPreferido        HorarioTreino?
  treinarEmCasa           Boolean   @default(false)
  
  // NOVO: HistÃ³rico
  pesoMaximoHistorico     Float?
  pesoMinimoHistorico     Float?
  melhorFormaFisica       String?
  tentativasAnteriores    String?
  
  // NOVO: ErgogÃªnicos
  usaEsteroides           Boolean   @default(false)
  trt                     Boolean   @default(false)
  esteroidesDetalhes      String?   // Criptografado
  
  // PreferÃªncias (existente)
  unitSystem      UnitSystem @default(METRIC)
  preferredMethod ProportionMethod @default(GOLDEN_RATIO)
  
  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("profiles")
}

// ============================================
// CONDIÃ‡Ã•ES DE SAÃšDE (NOVO)
// ============================================

model CondicaoSaude {
  id              String   @id @default(cuid())
  userId          String
  
  nome            String
  severidade      Severidade  @default(LEVE)
  controlada      Boolean     @default(false)
  medicacao       String?
  observacoes     String?
  
  ativo           Boolean     @default(true)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("condicoes_saude")
}

// ============================================
// LESÃ•ES (NOVO)
// ============================================

model Lesao {
  id              String   @id @default(cuid())
  userId          String
  
  local           String              // "Ombro esquerdo"
  tipo            String              // "Tendinite"
  dataOcorrencia  DateTime?
  recuperada      Boolean   @default(false)
  restricoes      String[]            // ExercÃ­cios a evitar
  observacoes     String?
  
  ativo           Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("lesoes")
}

// ============================================
// MEDICAMENTOS (NOVO)
// ============================================

model Medicamento {
  id              String   @id @default(cuid())
  userId          String
  
  nome            String
  principioAtivo  String?
  dosagem         String
  frequencia      String
  horario         String?
  motivo          String
  efeitosColaterais String[]
  
  ativo           Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("medicamentos")
}

// ============================================
// SUPLEMENTOS (NOVO)
// ============================================

model Suplemento {
  id              String   @id @default(cuid())
  userId          String
  
  nome            String
  marca           String?
  dosagem         String
  frequencia      String
  objetivo        String
  
  ativo           Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("suplementos")
}

// ============================================
// ENUMS NOVOS
// ============================================

enum RotinaDiaria {
  SEDENTARIA
  LEVE
  MODERADA
  ATIVA
  MUITO_ATIVA
}

enum QualidadeSono {
  RUIM
  REGULAR
  BOA
  EXCELENTE
}

enum NivelEstresse {
  BAIXO
  MODERADO
  ALTO
  MUITO_ALTO
}

enum ExperienciaTreino {
  INICIANTE
  INTERMEDIARIO
  AVANCADO
  EXPERIENTE
  VETERANO
}

enum LocalTreino {
  ACADEMIA_COMPLETA
  ACADEMIA_SIMPLES
  HOME_GYM
  CASA_BASICO
  MISTO
}

enum TipoDieta {
  SEM_RESTRICAO
  VEGETARIANA
  VEGANA
  PESCETARIANA
  LOW_CARB
  CETOGENICA
  MEDITERRANEA
  FLEXIVEL
  OUTRA
}

enum Orcamento {
  BAIXO
  MODERADO
  ALTO
  SEM_LIMITE
}

enum ObjetivoPrincipal {
  ESTETICA
  HIPERTROFIA
  DEFINICAO
  RECOMPOSICAO
  FORCA
  SAUDE
  COMPETICAO
  MANUTENCAO
}

enum PrazoObjetivo {
  TRES_MESES
  SEIS_MESES
  UM_ANO
  DOIS_ANOS
  SEM_PRAZO
}

enum HorarioTreino {
  MANHA_CEDO
  MANHA
  ALMOCO
  TARDE
  NOITE
  MADRUGADA
  FLEXIVEL
}

enum Severidade {
  LEVE
  MODERADA
  GRAVE
}
```

---

## 3. ARQUITETURA DO SISTEMA (Atualizada)

### 3.1 Pipeline de Processamento

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DADOS COMPLETOS â”‚â”€â”€â”€â”€â–¶â”‚  ANÃLISE E       â”‚â”€â”€â”€â”€â–¶â”‚  GERAÃ‡ÃƒO DE      â”‚
â”‚  DO USUÃRIO      â”‚     â”‚  CRUZAMENTO      â”‚     â”‚  PLANOS          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â–¼                        â–¼                        â–¼
  â€¢ Medidas corporais      â€¢ Scores proporÃ§Ãµes     â€¢ Plano de treino
  â€¢ Perfil de saÃºde        â€¢ Gaps identificados    â€¢ Plano alimentar
  â€¢ CondiÃ§Ãµes mÃ©dicas      â€¢ Prioridades           â€¢ RecomendaÃ§Ãµes
  â€¢ Medicamentos           â€¢ RestriÃ§Ãµes saÃºde      â€¢ Timeline
  â€¢ Rotina de vida         â€¢ AnÃ¡lise de risco      â€¢ Alertas seguranÃ§a
  â€¢ Objetivos              â€¢ Contexto cruzado      â€¢ Ajustes periÃ³dicos
```

### 3.2 Componentes do Sistema

```typescript
interface AICoachSystem {
  // ============================================
  // COLETORES DE CONTEXTO (NOVO)
  // ============================================
  collectors: {
    profile: ProfileCollector           // Coleta dados do perfil
    health: HealthCollector             // Coleta condiÃ§Ãµes de saÃºde
    medications: MedicationCollector    // Coleta medicamentos
    lifestyle: LifestyleCollector       // Coleta dados de rotina
    goals: GoalCollector                // Coleta objetivos
  }
  
  // ============================================
  // ANALISADORES
  // ============================================
  analyzers: {
    proportions: ProportionAnalyzer     // Analisa proporÃ§Ãµes vs ideais
    symmetry: SymmetryAnalyzer          // Analisa simetria bilateral
    evolution: EvolutionAnalyzer        // Analisa tendÃªncias temporais
    aesthetic: AestheticAnalyzer        // DiagnÃ³stico estÃ©tico geral
    risk: RiskAnalyzer                  // NOVO: Analisa riscos de saÃºde
    readiness: ReadinessAnalyzer        // NOVO: Analisa prontidÃ£o para treino
  }
  
  // ============================================
  // GERADORES DE CONTEÃšDO
  // ============================================
  generators: {
    insights: InsightGenerator          // Gera insights diÃ¡rios
    reports: ReportGenerator            // Gera relatÃ³rios semanais
    recommendations: RecommendationGenerator
    alerts: AlertGenerator
    
    // NOVOS
    training: TrainingPlanGenerator     // Gera plano de treino
    nutrition: NutritionPlanGenerator   // Gera plano alimentar
    periodization: PeriodizationGenerator // Gera periodizaÃ§Ã£o
  }
  
  // ============================================
  // PERSONALIZADOR
  // ============================================
  personalizer: {
    tone: ToneAdapter                   // Adapta tom de voz
    context: ContextBuilder             // ConstrÃ³i contexto completo
    history: HistoryManager             // Gerencia histÃ³rico
    safety: SafetyChecker               // NOVO: Verifica seguranÃ§a
  }
}
```

### 3.3 Context Builder (NOVO)

O Context Builder Ã© responsÃ¡vel por montar o contexto completo para a IA.

```typescript
class ContextBuilder {
  
  async buildFullContext(userId: string): Promise<AIContext> {
    // Buscar todos os dados do usuÃ¡rio
    const [
      user,
      profile,
      condicoes,
      lesoes,
      medicamentos,
      suplementos,
      latestMeasurement,
      measurementHistory,
      scores,
      goals
    ] = await Promise.all([
      this.getUser(userId),
      this.getProfile(userId),
      this.getCondicoesSaude(userId),
      this.getLesoes(userId),
      this.getMedicamentos(userId),
      this.getSuplementos(userId),
      this.getLatestMeasurement(userId),
      this.getMeasurementHistory(userId, 90), // Ãºltimos 90 dias
      this.getLatestScores(userId),
      this.getGoals(userId)
    ])
    
    // Calcular mÃ©tricas derivadas
    const idade = this.calcularIdade(profile.birthDate)
    const tmb = this.calcularTMB(profile, latestMeasurement)
    const tdee = this.calcularTDEE(tmb, profile.rotinaDiaria, profile.frequenciaTreinoAtual)
    const nivelExperiencia = this.classificarExperiencia(profile.tempoTreinando)
    
    // Identificar restriÃ§Ãµes
    const restricoes = this.identificarRestricoes(lesoes, condicoes, medicamentos)
    
    // Montar contexto estruturado
    return {
      // IdentificaÃ§Ã£o
      nome: user.name,
      idade,
      genero: profile.gender,
      
      // FÃ­sico atual
      fisico: {
        altura: profile.altura,
        peso: latestMeasurement?.peso,
        gordura: latestMeasurement?.gorduraCorporal,
        massaMagra: this.calcularMassaMagra(latestMeasurement),
      },
      
      // Resultados da avaliaÃ§Ã£o
      avaliacao: {
        scoreGeral: scores?.scoreTotal,
        classificacao: scores?.classificacao,
        ratio: this.calcularRatio(latestMeasurement, profile),
        metodo: profile.preferredMethod,
        pontosFracos: this.identificarPontosFracos(scores),
        pontosFortes: this.identificarPontosFortes(scores),
        assimetrias: this.identificarAssimetrias(latestMeasurement),
      },
      
      // Contexto de vida
      vida: {
        profissao: profile.profissao,
        rotina: profile.rotinaDiaria,
        horasSono: profile.horasSono,
        qualidadeSono: profile.qualidadeSono,
        estresse: profile.nivelEstresse,
        horasTrabalho: profile.horasTrabalho,
      },
      
      // SaÃºde
      saude: {
        condicoes: condicoes.filter(c => c.ativo),
        lesoes: lesoes.filter(l => l.ativo && !l.recuperada),
        lesoesRecuperadas: lesoes.filter(l => l.recuperada),
        alergias: profile.alergias || [],
        restricoesMovimento: restricoes.movimento,
      },
      
      // FÃ¡rmacos
      farmacos: {
        medicamentos: medicamentos.filter(m => m.ativo),
        suplementos: suplementos.filter(s => s.ativo),
        usaEsteroides: profile.usaEsteroides,
        trt: profile.trt,
        interacoesAlerta: this.verificarInteracoes(medicamentos, suplementos),
      },
      
      // Treino
      treino: {
        experiencia: profile.tempoTreinando,
        nivelExperiencia,
        frequenciaAtual: profile.frequenciaTreinoAtual,
        frequenciaDesejada: profile.frequenciaTreinoDesejada,
        duracaoMax: profile.duracaoTreinoMax,
        local: profile.localTreino,
        equipamentos: profile.equipamentos || [],
        diasDisponiveis: profile.diasDisponiveisTreino || [],
        horario: profile.horarioPreferido,
        treinoAtual: profile.treinoAtual,
      },
      
      // AlimentaÃ§Ã£o
      alimentacao: {
        dieta: profile.dietaAtual,
        refeicoes: profile.refeicoesdia,
        cozinha: profile.cozinha,
        tempoPreparo: profile.tempoPreparoRefeicao,
        orcamento: profile.orcamentoAlimentacao,
        evitar: profile.alimentosEvitar || [],
        preferidos: profile.alimentosPreferidos || [],
        jejum: profile.fazJejum,
        horarioJejum: profile.horarioJejum,
        alergias: profile.alergias || [],
      },
      
      // Objetivos
      objetivo: {
        principal: profile.objetivoPrincipal,
        especifico: profile.objetivoEspecifico,
        prazo: profile.prazo,
        prioridades: profile.prioridades || [],
        competicao: profile.competicao,
        categoria: profile.categoriaInteresse,
        metas: goals,
      },
      
      // MÃ©tricas calculadas
      metricas: {
        tmb,
        tdee,
        caloriasGanho: tdee + 300,
        caloriasPerca: tdee - 500,
        caloriasManutencao: tdee,
        proteinaMinima: latestMeasurement?.peso * 1.6,
        proteinaIdeal: latestMeasurement?.peso * 2.0,
        proteinaMaxima: latestMeasurement?.peso * 2.4,
      },
      
      // RestriÃ§Ãµes consolidadas
      restricoes: {
        exercicios: restricoes.exercicios,
        movimentos: restricoes.movimento,
        alimentos: restricoes.alimentos,
        intensidade: restricoes.intensidade,
        alertas: restricoes.alertas,
      },
      
      // HistÃ³rico
      historico: {
        medicoes: measurementHistory.length,
        tendencia: this.calcularTendencia(measurementHistory),
        melhorScore: this.getMelhorScore(measurementHistory),
        consistencia: this.calcularConsistencia(measurementHistory),
      },
    }
  }
  
  private identificarRestricoes(
    lesoes: Lesao[],
    condicoes: CondicaoSaude[],
    medicamentos: Medicamento[]
  ): Restricoes {
    const restricoes: Restricoes = {
      exercicios: [],
      movimento: [],
      alimentos: [],
      intensidade: null,
      alertas: [],
    }
    
    // RestriÃ§Ãµes por lesÃµes
    for (const lesao of lesoes.filter(l => !l.recuperada)) {
      restricoes.exercicios.push(...(lesao.restricoes || []))
      restricoes.alertas.push(`LesÃ£o ativa: ${lesao.tipo} em ${lesao.local}`)
    }
    
    // RestriÃ§Ãµes por condiÃ§Ãµes de saÃºde
    for (const condicao of condicoes) {
      if (condicao.nome.toLowerCase().includes('cardÃ­ac') || 
          condicao.nome.toLowerCase().includes('coraÃ§Ã£o')) {
        restricoes.intensidade = 'moderada'
        restricoes.alertas.push('CondiÃ§Ã£o cardÃ­aca: evitar intensidade muito alta')
      }
      
      if (condicao.nome.toLowerCase().includes('diabetes')) {
        restricoes.alertas.push('Diabetes: monitorar glicemia, evitar jejum prolongado')
      }
      
      if (condicao.nome.toLowerCase().includes('pressÃ£o') ||
          condicao.nome.toLowerCase().includes('hipertensÃ£o')) {
        restricoes.alertas.push('HipertensÃ£o: evitar valsalva excessiva, monitorar pressÃ£o')
      }
    }
    
    // RestriÃ§Ãµes por medicamentos
    for (const med of medicamentos) {
      if (med.nome.toLowerCase().includes('anticoagulante')) {
        restricoes.alertas.push('Anticoagulante: cuidado com impactos e lesÃµes')
      }
      
      if (med.motivo.toLowerCase().includes('pressÃ£o')) {
        restricoes.alertas.push('Medicamento para pressÃ£o: monitorar durante treino')
      }
    }
    
    return restricoes
  }
}
```

---

## 4. GERAÃ‡ÃƒO DE PLANO DE TREINO (NOVO)

### 4.1 Estrutura do Plano de Treino

```typescript
interface PlanoTreino {
  // Metadata
  id: string
  userId: string
  criadoEm: Date
  validoAte: Date                     // Quando deve ser reavaliado
  versao: number
  
  // VisÃ£o geral
  visaoGeral: {
    titulo: string                    // "Plano Hipertrofia - Foco V-Taper"
    descricao: string
    duracao: string                   // "8 semanas"
    objetivo: string
    divisao: DivisaoTreino
    diasPorSemana: number
  }
  
  // Dias de treino
  dias: DiaTreino[]
  
  // Prioridades baseadas na avaliaÃ§Ã£o
  prioridades: {
    musculosFoco: string[]            // ["DeltÃ³ide lateral", "Peitoral superior"]
    correcaoSimetria: CorrecaoSimetria[]
    manutencao: string[]              // MÃºsculos para manter
  }
  
  // ProgressÃ£o
  progressao: {
    semana1a2: string                 // DescriÃ§Ã£o da fase
    semana3a4: string
    semana5a6: string
    semana7a8: string
    deload: string                    // Quando e como fazer deload
  }
  
  // Alertas de seguranÃ§a
  alertas: AlertaSeguranca[]
  
  // Ajustes personalizados
  ajustes: {
    porLesao: AjusteLesao[]
    porCondicao: AjusteCondicao[]
    porMedicamento: AjusteMedicamento[]
  }
}

interface DiaTreino {
  dia: DiaSemana
  nome: string                        // "Push A - ÃŠnfase Ombros"
  gruposMusculares: string[]
  duracaoEstimada: number             // minutos
  
  aquecimento: Exercicio[]
  exerciciosPrincipais: Exercicio[]
  exerciciosAcessorios: Exercicio[]
  finalizacao: Exercicio[]
  
  observacoes: string[]
  substituicoes: Substituicao[]       // Alternativas se nÃ£o tiver equipamento
}

interface Exercicio {
  id: string
  nome: string                        // "Desenvolvimento com halteres"
  musculoAlvo: string                 // "DeltÃ³ide anterior"
  musculosSecundarios: string[]       // ["TrÃ­ceps", "Peitoral superior"]
  
  // ExecuÃ§Ã£o
  series: number
  repeticoes: string                  // "8-12" ou "12-15" ou "atÃ© falha"
  descanso: number                    // segundos
  cadencia?: string                   // "3-1-2" (excÃªntrico-pausa-concÃªntrico)
  
  // TÃ©cnicas especiais
  tecnica?: TecnicaEspecial           // "Drop-set", "Rest-pause", etc.
  
  // Intensidade
  intensidade: string                 // "RPE 8" ou "70% 1RM"
  progressaoSemanal?: string          // "+2.5kg por semana"
  
  // InstruÃ§Ãµes
  execucao: string                    // Como executar corretamente
  dicasForma: string[]                // Dicas de forma
  errosComuns: string[]               // O que evitar
  
  // SubstituiÃ§Ãµes
  substituicoes: string[]             // ExercÃ­cios alternativos
  
  // SeguranÃ§a
  contraindicado?: string[]           // LesÃµes que impedem este exercÃ­cio
  cuidados?: string[]                 // Cuidados especiais
}

interface CorrecaoSimetria {
  musculo: string                     // "BraÃ§o"
  ladoMenor: 'esquerdo' | 'direito'
  diferencaPercent: number
  estrategia: string                  // "Iniciar sÃ©ries pelo lado menor"
  exerciciosUnilaterais: string[]
  seriesExtras: number                // SÃ©ries extras para o lado menor
}

type DivisaoTreino = 
  | 'FULL_BODY'           // Corpo todo (iniciantes, 2-3x/sem)
  | 'UPPER_LOWER'         // Superior/Inferior (intermediÃ¡rio, 4x/sem)
  | 'PPL'                 // Push/Pull/Legs (avanÃ§ado, 6x/sem)
  | 'PPLX2'               // PPL 2x por semana
  | 'BRO_SPLIT'           // 1 mÃºsculo por dia (5x/sem)
  | 'ARNOLD_SPLIT'        // Peito+Costas, Ombros+BraÃ§os, Pernas
  | 'CUSTOM'              // Personalizado

type TecnicaEspecial = 
  | 'DROP_SET'
  | 'REST_PAUSE'
  | 'MIOTREPS'
  | 'SUPERSET'
  | 'GIANT_SET'
  | 'CLUSTER'
  | 'TEMPO'
  | 'ISOMETRICO'
```

### 4.2 Prompt para GeraÃ§Ã£o de Treino

```typescript
const TRAINING_PLAN_PROMPT = `
VocÃª Ã© VITRÃšVIO, o coach de IA do VITRU IA. Seu nome Ã© uma homenagem a Marcus Vitruvius Pollio, 
o arquiteto romano que definiu as proporÃ§Ãµes ideais do corpo humano. VocÃª Ã© especialista em criar 
planos de treino personalizados para otimizaÃ§Ã£o de proporÃ§Ãµes corporais e estÃ©tica.

## CONTEXTO COMPLETO DO USUÃRIO
{{userContext}}

## RESULTADOS DA AVALIAÃ‡ÃƒO
Score Geral: {{scoreGeral}} ({{classificacao}})
Ratio Ombro/Cintura: {{ratio}}

### Pontos Fracos (PRIORIDADE)
{{pontosFracos}}

### Pontos Fortes (MANTER)
{{pontosFortes}}

### Assimetrias a Corrigir
{{assimetrias}}

## RESTRIÃ‡Ã•ES IMPORTANTES
{{restricoes}}

## INSTRUÃ‡Ã•ES

Crie um plano de treino completo considerando:

### 1. DIVISÃƒO DE TREINO
- Considere a experiÃªncia: {{experiencia}}
- Dias disponÃ­veis: {{diasDisponiveis}}
- DuraÃ§Ã£o mÃ¡xima: {{duracaoMax}} minutos
- Local: {{localTreino}}
- Equipamentos: {{equipamentos}}

### 2. PRIORIZAÃ‡ÃƒO
- Foque nos pontos fracos identificados na avaliaÃ§Ã£o
- Os mÃºsculos prioritÃ¡rios devem:
  - Ser treinados primeiro no dia (quando mais energia)
  - Ter mais volume semanal (sÃ©ries totais)
  - Usar tÃ©cnicas intensificadoras

### 3. CORREÃ‡ÃƒO DE SIMETRIA
Para cada assimetria > 5%:
- Incluir exercÃ­cios unilaterais
- Lado menor inicia o movimento
- 1-2 sÃ©ries extras para o lado menor

### 4. SEGURANÃ‡A
{{alertasSaude}}
- Respeitar todas as lesÃµes e restriÃ§Ãµes
- Ajustar intensidade conforme condiÃ§Ãµes mÃ©dicas
- Considerar interaÃ§Ãµes com medicamentos

### 5. PROGRESSÃƒO
- Semanas 1-2: AdaptaÃ§Ã£o (RPE 7)
- Semanas 3-4: ProgressÃ£o (RPE 8)
- Semanas 5-6: IntensificaÃ§Ã£o (RPE 8-9)
- Semana 7-8: Pico + Deload

### 6. FORMATO DE RESPOSTA
Para cada exercÃ­cio, forneÃ§a:
- Nome do exercÃ­cio
- MÃºsculo alvo
- SÃ©ries x RepetiÃ§Ãµes
- Descanso
- TÃ©cnica de execuÃ§Ã£o (breve)
- SubstituiÃ§Ã£o se nÃ£o tiver equipamento

## RESTRIÃ‡Ã•ES ABSOLUTAS
- NUNCA prescreva exercÃ­cios contraindicados para as lesÃµes listadas
- SEMPRE reduza intensidade se houver condiÃ§Ã£o cardÃ­aca
- CONSIDERE efeitos de medicamentos na performance
- ADAPTE para os equipamentos disponÃ­veis

## FORMATO JSON
{
  "visaoGeral": {
    "titulo": "string",
    "descricao": "string",
    "duracao": "string",
    "divisao": "string",
    "diasPorSemana": number
  },
  "prioridades": {
    "musculosFoco": ["string"],
    "correcaoSimetria": [{"musculo": "string", "estrategia": "string"}],
    "manutencao": ["string"]
  },
  "dias": [
    {
      "dia": "string",
      "nome": "string",
      "gruposMusculares": ["string"],
      "duracaoEstimada": number,
      "exercicios": [
        {
          "nome": "string",
          "musculoAlvo": "string",
          "series": number,
          "repeticoes": "string",
          "descanso": number,
          "execucao": "string",
          "substituicao": "string"
        }
      ],
      "observacoes": ["string"]
    }
  ],
  "progressao": {
    "descricao": "string",
    "semanasAdaptacao": "string",
    "semanasProgressao": "string",
    "deload": "string"
  },
  "alertasSeguranca": ["string"]
}
`
```

---

## 5. GERAÃ‡ÃƒO DE PLANO ALIMENTAR (NOVO)

### 5.1 Estrutura do Plano Alimentar

```typescript
interface PlanoAlimentar {
  // Metadata
  id: string
  userId: string
  criadoEm: Date
  validoAte: Date
  versao: number
  
  // VisÃ£o geral
  visaoGeral: {
    titulo: string                    // "Plano Hipertrofia - SuperÃ¡vit Moderado"
    objetivo: string                  // "Ganho de massa com mÃ­nimo de gordura"
    faseDieta: FaseDieta
    duracaoSugerida: string
  }
  
  // Calorias e macros
  calorias: {
    tdee: number                      // Gasto energÃ©tico total
    meta: number                      // Calorias alvo
    ajuste: string                    // "+300kcal (superÃ¡vit moderado)"
  }
  
  macros: {
    proteina: MacroConfig
    carboidrato: MacroConfig
    gordura: MacroConfig
  }
  
  // DistribuiÃ§Ã£o
  distribuicao: {
    refeicoesdia: number
    timing: TimingNutricional
    refeicoes: Refeicao[]
  }
  
  // SuplementaÃ§Ã£o
  suplementacao: {
    essenciais: SuplementoRecomendado[]
    opcionais: SuplementoRecomendado[]
    evitar: string[]                  // Suplementos a evitar por saÃºde
  }
  
  // HidrataÃ§Ã£o
  hidratacao: {
    aguaDiaria: number                // litros
    observacoes: string
  }
  
  // Ajustes
  ajustes: {
    diasTreino: AjusteDia
    diasDescanso: AjusteDia
    finaisSemana: string
  }
  
  // Alertas
  alertas: AlertaNutricional[]
  
  // Lista de compras sugerida
  listaCompras: ItemCompra[]
}

interface MacroConfig {
  gramas: number
  gramasKg: number                    // Por kg de peso corporal
  calorias: number
  percentual: number
  fontesPrincipais: string[]
}

interface TimingNutricional {
  preWorkout: {
    tempo: string                     // "1-2h antes"
    composicao: string                // "Carboidrato complexo + proteÃ­na leve"
    exemplo: string
  }
  intraWorkout?: {
    necessario: boolean
    composicao?: string
    exemplo?: string
  }
  posWorkout: {
    tempo: string                     // "AtÃ© 2h apÃ³s"
    composicao: string                // "ProteÃ­na rÃ¡pida + carboidrato"
    exemplo: string
  }
  antesDeDoimir: {
    tempo: string
    composicao: string
    exemplo: string
  }
}

interface Refeicao {
  numero: number
  nome: string                        // "CafÃ© da manhÃ£"
  horarioSugerido: string             // "7:00"
  calorias: number
  macros: { proteina: number; carboidrato: number; gordura: number }
  
  opcoes: OpcaoRefeicao[]             // 2-3 opÃ§Ãµes por refeiÃ§Ã£o
  
  observacoes?: string
}

interface OpcaoRefeicao {
  nome: string                        // "OpÃ§Ã£o 1 - Ovos com aveia"
  alimentos: AlimentoQuantidade[]
  tempoPreparo: number                // minutos
  dificuldade: 'facil' | 'media' | 'dificil'
  custo: 'baixo' | 'medio' | 'alto'
  
  macros: { proteina: number; carboidrato: number; gordura: number }
  calorias: number
}

interface AlimentoQuantidade {
  alimento: string
  quantidade: number
  unidade: string                     // "g", "ml", "unidade", "xÃ­cara"
  observacao?: string                 // "cozido", "cru", etc.
}

interface SuplementoRecomendado {
  nome: string
  dosagem: string
  horario: string
  motivo: string
  essencial: boolean
  custoMensal?: string
}

interface AlertaNutricional {
  tipo: 'saude' | 'interacao' | 'alergia' | 'restricao'
  titulo: string
  descricao: string
  acao: string
}

type FaseDieta = 
  | 'SUPERAVIT_AGRESSIVO'    // +500kcal
  | 'SUPERAVIT_MODERADO'     // +300kcal
  | 'SUPERAVIT_LEVE'         // +150kcal
  | 'MANUTENCAO'             // TDEE
  | 'DEFICIT_LEVE'           // -300kcal
  | 'DEFICIT_MODERADO'       // -500kcal
  | 'DEFICIT_AGRESSIVO'      // -750kcal
  | 'RECOMPOSICAO'           // CÃ­clico
```

### 5.2 Prompt para GeraÃ§Ã£o de Dieta

```typescript
const NUTRITION_PLAN_PROMPT = `
VocÃª Ã© VITRÃšVIO, o coach de IA do VITRU IA. Seu nome Ã© uma homenagem a Marcus Vitruvius Pollio, 
o arquiteto romano que definiu as proporÃ§Ãµes ideais do corpo humano. VocÃª Ã© especialista em 
nutriÃ§Ã£o esportiva focada em otimizaÃ§Ã£o de composiÃ§Ã£o corporal e estÃ©tica.

## CONTEXTO COMPLETO DO USUÃRIO
{{userContext}}

## DADOS FÃSICOS
- Peso atual: {{peso}} kg
- Altura: {{altura}} cm
- Gordura corporal: {{gordura}}%
- Massa magra estimada: {{massaMagra}} kg

## MÃ‰TRICAS CALCULADAS
- TMB: {{tmb}} kcal
- TDEE: {{tdee}} kcal
- ProteÃ­na mÃ­nima: {{proteinaMin}}g (1.6g/kg)
- ProteÃ­na ideal: {{proteinaIdeal}}g (2.0g/kg)

## OBJETIVO
{{objetivoPrincipal}}: {{objetivoEspecifico}}
Prazo: {{prazo}}

## PREFERÃŠNCIAS ALIMENTARES
- Dieta atual: {{dietaAtual}}
- RefeiÃ§Ãµes por dia: {{refeicoesdia}}
- Sabe cozinhar: {{cozinha}}
- Tempo para preparar: {{tempoPreparo}} minutos
- OrÃ§amento: {{orcamento}}
- Faz jejum: {{fazJejum}} {{horarioJejum}}

### Alimentos a EVITAR (nÃ£o gosta ou nÃ£o pode)
{{alimentosEvitar}}

### Alimentos PREFERIDOS
{{alimentosPreferidos}}

### Alergias/IntolerÃ¢ncias
{{alergias}}

## CONDIÃ‡Ã•ES DE SAÃšDE RELEVANTES
{{condicoesSaude}}

## MEDICAMENTOS QUE AFETAM DIETA
{{medicamentosRelevantes}}

## SUPLEMENTOS ATUAIS
{{suplementosAtuais}}

## INSTRUÃ‡Ã•ES

Crie um plano alimentar completo considerando:

### 1. CALORIAS
- Calcule o ajuste calÃ³rico baseado no objetivo
- SuperÃ¡vit para ganho: +200 a +400kcal
- DÃ©ficit para perda: -300 a -500kcal
- Considere o nÃ­vel de atividade e metabolismo

### 2. MACRONUTRIENTES
- ProteÃ­na: 1.8-2.2g/kg para hipertrofia
- Gordura: mÃ­nimo 0.8g/kg para saÃºde hormonal
- Carboidrato: restante das calorias

### 3. RESTRIÃ‡Ã•ES DE SAÃšDE
{{restricoesSaude}}
- Diabetes: controlar Ã­ndice glicÃªmico, distribuir carboidratos
- HipertensÃ£o: limitar sÃ³dio
- Colesterol: limitar gorduras saturadas
- Problemas renais: ajustar proteÃ­na se necessÃ¡rio

### 4. PRATICIDADE
- RefeiÃ§Ãµes simples se pouco tempo
- Meal prep se disponÃ­vel
- OpÃ§Ãµes econÃ´micas se orÃ§amento baixo
- Considerar rotina de trabalho

### 5. TIMING NUTRICIONAL
- PrÃ©-treino: energia para performance
- PÃ³s-treino: recuperaÃ§Ã£o e sÃ­ntese proteica
- Antes de dormir: proteÃ­na lenta (se aplicÃ¡vel)

### 6. SUPLEMENTAÃ‡ÃƒO
- Avaliar necessidade real
- Considerar custo-benefÃ­cio
- Verificar interaÃ§Ãµes com medicamentos
- Nunca substituir alimentaÃ§Ã£o

## RESTRIÃ‡Ã•ES ABSOLUTAS
- NUNCA inclua alimentos que o usuÃ¡rio Ã© alÃ©rgico
- RESPEITE a dieta escolhida (vegana, vegetariana, etc.)
- CONSIDERE interaÃ§Ãµes medicamento-alimento
- AJUSTE para condiÃ§Ãµes de saÃºde especÃ­ficas

## FORMATO JSON
{
  "visaoGeral": {
    "titulo": "string",
    "objetivo": "string",
    "faseDieta": "string",
    "duracaoSugerida": "string"
  },
  "calorias": {
    "tdee": number,
    "meta": number,
    "ajuste": "string"
  },
  "macros": {
    "proteina": {"gramas": number, "gramasKg": number, "calorias": number, "percentual": number},
    "carboidrato": {"gramas": number, "gramasKg": number, "calorias": number, "percentual": number},
    "gordura": {"gramas": number, "gramasKg": number, "calorias": number, "percentual": number}
  },
  "distribuicao": {
    "refeicoesdia": number,
    "timing": {
      "preWorkout": {"tempo": "string", "composicao": "string", "exemplo": "string"},
      "posWorkout": {"tempo": "string", "composicao": "string", "exemplo": "string"}
    }
  },
  "refeicoes": [
    {
      "numero": number,
      "nome": "string",
      "horarioSugerido": "string",
      "calorias": number,
      "opcoes": [
        {
          "nome": "string",
          "alimentos": [{"alimento": "string", "quantidade": number, "unidade": "string"}],
          "tempoPreparo": number,
          "macros": {"proteina": number, "carboidrato": number, "gordura": number}
        }
      ]
    }
  ],
  "suplementacao": {
    "essenciais": [{"nome": "string", "dosagem": "string", "horario": "string", "motivo": "string"}],
    "opcionais": [{"nome": "string", "dosagem": "string", "motivo": "string"}],
    "evitar": ["string"]
  },
  "hidratacao": {
    "litrosDia": number,
    "observacoes": "string"
  },
  "alertas": [{"tipo": "string", "titulo": "string", "descricao": "string"}],
  "listaComprasSemanal": ["string"]
}
`
```

---

## 6. TIPOS DE ANÃLISE (Mantido + Expandido)

### 6.1 AnÃ¡lise de ProporÃ§Ãµes
*(Mantido da versÃ£o anterior)*

### 6.2 AnÃ¡lise de Simetria
*(Mantido da versÃ£o anterior)*

### 6.3 AnÃ¡lise de EvoluÃ§Ã£o
*(Mantido da versÃ£o anterior)*

### 6.4 DiagnÃ³stico EstÃ©tico
*(Mantido da versÃ£o anterior)*

### 6.5 AnÃ¡lise de Risco (NOVO)

```typescript
interface RiskAnalysis {
  // Score de risco geral
  overallRisk: 'baixo' | 'moderado' | 'alto' | 'muito_alto'
  riskScore: number                   // 0-100
  
  // Riscos por categoria
  riscos: {
    cardiovascular: RiscoCategoria
    musculoesqueletico: RiscoCategoria
    metabolico: RiscoCategoria
    farmacologico: RiscoCategoria
  }
  
  // RecomendaÃ§Ãµes de seguranÃ§a
  recomendacoes: {
    obrigatorias: string[]            // DEVE fazer
    sugeridas: string[]               // DEVERIA fazer
    evitar: string[]                  // NÃƒO deve fazer
  }
  
  // Exames sugeridos
  examesSugeridos: string[]
  
  // Acompanhamento profissional
  profissionaisRecomendados: string[] // "Cardiologista", "Fisioterapeuta"
}

interface RiscoCategoria {
  nivel: 'baixo' | 'moderado' | 'alto'
  fatores: string[]
  mitigacao: string[]
}
```

---

## 7. GERAÃ‡ÃƒO DE INSIGHTS (Expandido)

### 7.1 Novos Tipos de Insights

```typescript
type InsightType = 
  // Existentes
  | 'progress'
  | 'achievement'
  | 'warning'
  | 'tip'
  | 'motivation'
  | 'reminder'
  | 'comparison'
  | 'projection'
  | 'education'
  
  // NOVOS
  | 'training_adjustment'     // Ajuste no treino sugerido
  | 'diet_adjustment'         // Ajuste na dieta sugerido
  | 'health_alert'            // Alerta de saÃºde
  | 'supplement_reminder'     // Lembrete de suplemento
  | 'recovery'                // Dica de recuperaÃ§Ã£o
  | 'sleep'                   // Insight sobre sono
  | 'stress'                  // Insight sobre estresse
  | 'plateau'                 // Detectou platÃ´
  | 'deload'                  // SugestÃ£o de deload
```

### 7.2 Insights Contextuais (NOVO)

```typescript
// Insights que usam o contexto completo do usuÃ¡rio

const CONTEXTUAL_INSIGHTS = {
  // Baseado em sono
  poorSleep: {
    condition: (ctx) => ctx.vida.horasSono < 6 || ctx.vida.qualidadeSono === 'ruim',
    insight: {
      type: 'sleep',
      title: 'Sono prejudicando ganhos',
      message: 'Seu sono de {{horasSono}}h pode estar limitando seus resultados. ' +
               'A sÃ­ntese proteica muscular acontece principalmente durante o sono profundo.',
      action: 'Ver dicas de sono',
      priority: 'high'
    }
  },
  
  // Baseado em estresse
  highStress: {
    condition: (ctx) => ctx.vida.estresse === 'alto' || ctx.vida.estresse === 'muito_alto',
    insight: {
      type: 'stress',
      title: 'Estresse elevado detectado',
      message: 'O cortisol elevado pode dificultar ganho muscular e facilitar acÃºmulo de gordura. ' +
               'Considere tÃ©cnicas de relaxamento.',
      action: 'Ver tÃ©cnicas anti-estresse',
      priority: 'medium'
    }
  },
  
  // Baseado em medicamentos
  medicationInteraction: {
    condition: (ctx) => ctx.farmacos.interacoesAlerta.length > 0,
    insight: {
      type: 'health_alert',
      title: 'AtenÃ§Ã£o com suplementaÃ§Ã£o',
      message: 'Alguns suplementos podem interagir com {{medicamento}}. ' +
               'Consulte seu mÃ©dico antes de iniciar nova suplementaÃ§Ã£o.',
      action: 'Ver detalhes',
      priority: 'high'
    }
  },
  
  // Baseado em platÃ´
  plateau: {
    condition: (ctx) => ctx.historico.tendencia === 'estagnado' && ctx.historico.medicoes >= 4,
    insight: {
      type: 'plateau',
      title: 'PossÃ­vel platÃ´ detectado',
      message: 'Suas medidas estÃ£o estagnadas hÃ¡ {{semanas}} semanas. ' +
               'Pode ser hora de ajustar treino ou dieta.',
      action: 'Ver sugestÃµes de quebra de platÃ´',
      priority: 'high'
    }
  },
  
  // SugestÃ£o de deload
  needsDeload: {
    condition: (ctx) => ctx.treino.semanasConsecutivas >= 6 && !ctx.treino.fezDeloadRecente,
    insight: {
      type: 'deload',
      title: 'Hora do deload?',
      message: 'VocÃª estÃ¡ hÃ¡ {{semanas}} semanas treinando intenso. ' +
               'Uma semana de deload pode potencializar seus ganhos.',
      action: 'Ver como fazer deload',
      priority: 'medium'
    }
  },
}
```

---

## 8. INTERFACE DE CHAT (NOVO)

### 8.1 Estrutura do Chat

```typescript
interface ChatMessage {
  id: string
  conversationId: string
  role: 'user' | 'assistant'
  content: string
  timestamp: Date
  
  // Metadata
  context?: {
    type: 'general' | 'training' | 'nutrition' | 'health' | 'analysis'
    relatedData?: string              // ID de mediÃ§Ã£o, plano, etc.
  }
  
  // AÃ§Ãµes sugeridas pelo assistant
  suggestedActions?: Array<{
    label: string
    action: string                    // 'generate_plan', 'show_analysis', etc.
    params?: Record<string, any>
  }>
  
  // Feedback do usuÃ¡rio
  feedback?: {
    helpful: boolean
    timestamp: Date
  }
}

interface Conversation {
  id: string
  userId: string
  startedAt: Date
  lastMessageAt: Date
  messageCount: number
  topic?: string                      // Resumo do assunto
  resolved: boolean
}
```

### 8.2 System Prompt do Chat

```typescript
const CHAT_SYSTEM_PROMPT = `
VocÃª Ã© VITRÃšVIO, o coach de IA do VITRU IA. Seu nome Ã© uma homenagem a Marcus Vitruvius Pollio, 
o arquiteto romano que definiu as proporÃ§Ãµes ideais do corpo humano - os mesmos princÃ­pios que 
inspiraram o Homem Vitruviano de Da Vinci. VocÃª Ã© especialista em anÃ¡lise de proporÃ§Ãµes corporais, 
treino e nutriÃ§Ã£o para fisiculturismo estÃ©tico.

## SEU CONTEXTO DO USUÃRIO
{{userContext}}

## SUAS CAPACIDADES
1. Responder dÃºvidas sobre treino, dieta e proporÃ§Ãµes
2. Explicar resultados da avaliaÃ§Ã£o
3. Sugerir ajustes no plano atual
4. Dar dicas de execuÃ§Ã£o de exercÃ­cios
5. Orientar sobre nutriÃ§Ã£o
6. Motivar e acompanhar o progresso

## SUAS LIMITAÃ‡Ã•ES
1. NÃƒO Ã© mÃ©dico - sempre sugira consultar profissionais para questÃµes de saÃºde
2. NÃƒO pode prescrever medicamentos ou dosagens
3. NÃƒO pode diagnosticar condiÃ§Ãµes mÃ©dicas
4. DEVE respeitar as restriÃ§Ãµes de saÃºde do usuÃ¡rio

## REGRAS DE SEGURANÃ‡A
- Se o usuÃ¡rio perguntar sobre esteroides: orientar sobre riscos, nunca incentivar
- Se detectar sinais de distÃºrbio alimentar: sugerir acompanhamento psicolÃ³gico
- Se houver lesÃ£o ativa: sempre priorizar recuperaÃ§Ã£o sobre progresso
- Se houver condiÃ§Ã£o de saÃºde: considerar nas recomendaÃ§Ãµes

## TOM DE VOZ
- TÃ©cnico mas acessÃ­vel
- Motivador mas realista
- Personalizado (use o nome do usuÃ¡rio)
- EmpÃ¡tico e compreensivo
- Direto ao ponto

## FORMATO DE RESPOSTAS
- Respostas concisas para perguntas simples
- Respostas estruturadas para perguntas complexas
- Sempre ofereÃ§a prÃ³ximos passos quando relevante
- Use bullet points para listas
- Use emojis com moderaÃ§Ã£o para engajar

## CONTEXTO DA CONVERSA
{{conversationHistory}}

Responda Ã  mensagem do usuÃ¡rio de forma Ãºtil e personalizada.
`
```

---

## 9. LIMITES FREE vs PRO (Atualizado)

### 9.1 Tabela de Features

| Feature | Free | PRO |
|---------|------|-----|
| **Insights diÃ¡rios** | 3 | Ilimitados |
| **Tipos de insight** | BÃ¡sicos | Todos (incluindo contextuais) |
| **RelatÃ³rio semanal** | Resumido | Completo |
| **RelatÃ³rio mensal** | âŒ | âœ… |
| **AnÃ¡lise de proporÃ§Ãµes** | Score geral | Breakdown completo |
| **AnÃ¡lise de simetria** | BÃ¡sica (2 mÃºsculos) | Completa (todos) |
| **AnÃ¡lise de evoluÃ§Ã£o** | 30 dias | HistÃ³rico completo |
| **DiagnÃ³stico estÃ©tico** | âŒ | âœ… |
| **AnÃ¡lise de risco** | âŒ | âœ… |
| **ProjeÃ§Ãµes** | âŒ | âœ… |
| **Chat com VITRÃšVIO** | 5 msgs/dia | Ilimitado |
| **Plano de Treino** | GenÃ©rico | Personalizado completo |
| **Plano Alimentar** | Macros bÃ¡sicos | Completo com refeiÃ§Ãµes |
| **Ajustes de plano** | âŒ | âœ… (ilimitados) |
| **Exportar relatÃ³rios** | âŒ | âœ… (PDF) |
| **HistÃ³rico de planos** | âŒ | âœ… |

---

## 10. INTEGRAÃ‡ÃƒO COM LLM (Atualizado)

### 10.1 ConfiguraÃ§Ã£o

```typescript
const AI_COACH_CONFIG: LLMConfig = {
  provider: 'anthropic',              // ou 'openai'
  model: 'claude-3-5-sonnet',         // ou 'gpt-4-turbo'
  temperature: 0.7,
  maxTokens: 4000,                    // Aumentado para planos completos
  systemPrompt: COACH_SYSTEM_PROMPT,
}

// Modelos por tipo de tarefa
const MODEL_CONFIG = {
  chat: { model: 'claude-3-5-sonnet', maxTokens: 1000 },
  analysis: { model: 'claude-3-5-sonnet', maxTokens: 2000 },
  trainingPlan: { model: 'claude-3-5-sonnet', maxTokens: 4000 },
  nutritionPlan: { model: 'claude-3-5-sonnet', maxTokens: 4000 },
  insights: { model: 'claude-3-haiku', maxTokens: 500 },  // Mais rÃ¡pido/barato
}
```

### 10.2 Rate Limiting e Custos

```typescript
const RATE_LIMITS = {
  free: {
    chatMessagesPerDay: 5,
    plansPerMonth: 1,
    analysisPerDay: 3,
  },
  pro: {
    chatMessagesPerDay: null,         // Ilimitado
    plansPerMonth: null,              // Ilimitado
    analysisPerDay: null,             // Ilimitado
  }
}
```

---

## 11. MÃ‰TRICAS E MONITORAMENTO (Expandido)

### 11.1 KPIs do VITRÃšVIO

| MÃ©trica | DescriÃ§Ã£o | Meta |
|---------|-----------|------|
| Insight Click Rate | % de insights clicados | > 30% |
| Report Open Rate | % de relatÃ³rios abertos | > 60% |
| Plan Completion Rate | % de planos seguidos | > 40% |
| Chat Satisfaction | NPS do chat | > 50 |
| Training Adherence | % de treinos completados | > 70% |
| Diet Adherence | % de dieta seguida | > 60% |
| Retention Impact | RetenÃ§Ã£o PRO vs Free | +30% |
| Results Achievement | % que atingiu metas | > 25% |

---

## 12. FLUXO DE COLETA DE DADOS

### 12.1 Onboarding Expandido

```
ETAPA 1: DADOS BÃSICOS
â”œâ”€â”€ Nome, email, senha
â”œâ”€â”€ GÃªnero, data de nascimento
â””â”€â”€ Altura

ETAPA 2: PERFIL DE VIDA
â”œâ”€â”€ ProfissÃ£o
â”œâ”€â”€ Rotina diÃ¡ria (sedentÃ¡ria â†’ muito ativa)
â”œâ”€â”€ Horas de sono
â”œâ”€â”€ NÃ­vel de estresse
â””â”€â”€ Horas de trabalho

ETAPA 3: SAÃšDE
â”œâ”€â”€ CondiÃ§Ãµes de saÃºde (lista com busca)
â”œâ”€â”€ LesÃµes atuais ou passadas
â”œâ”€â”€ Alergias alimentares
â””â”€â”€ RestriÃ§Ãµes de movimento

ETAPA 4: MEDICAMENTOS
â”œâ”€â”€ Medicamentos em uso
â”œâ”€â”€ Dosagem e frequÃªncia
â”œâ”€â”€ Suplementos atuais
â””â”€â”€ Uso de ergogÃªnicos (opcional/confidencial)

ETAPA 5: EXPERIÃŠNCIA
â”œâ”€â”€ Tempo de treino
â”œâ”€â”€ FrequÃªncia atual
â”œâ”€â”€ Local de treino
â”œâ”€â”€ Equipamentos disponÃ­veis
â””â”€â”€ Treino atual (descriÃ§Ã£o)

ETAPA 6: ALIMENTAÃ‡ÃƒO
â”œâ”€â”€ Tipo de dieta
â”œâ”€â”€ RefeiÃ§Ãµes por dia
â”œâ”€â”€ Sabe cozinhar
â”œâ”€â”€ Tempo para preparar
â”œâ”€â”€ OrÃ§amento
â”œâ”€â”€ Alimentos a evitar
â””â”€â”€ Alimentos preferidos

ETAPA 7: OBJETIVOS
â”œâ”€â”€ Objetivo principal
â”œâ”€â”€ Objetivo especÃ­fico (texto)
â”œâ”€â”€ Prazo
â”œâ”€â”€ Prioridades (ranking)
â”œâ”€â”€ Pretende competir?
â””â”€â”€ Categoria de interesse

ETAPA 8: DISPONIBILIDADE
â”œâ”€â”€ Dias disponÃ­veis para treino
â”œâ”€â”€ HorÃ¡rio preferido
â”œâ”€â”€ Tempo mÃ¡ximo por sessÃ£o
â””â”€â”€ Pode treinar em casa?

ETAPA 9: MEDIDAS ESTRUTURAIS
â”œâ”€â”€ Punho, tornozelo, joelho, pelve
â””â”€â”€ (medidas que nÃ£o mudam)

ETAPA 10: PRIMEIRA AVALIAÃ‡ÃƒO
â”œâ”€â”€ Peso atual
â”œâ”€â”€ Medidas variÃ¡veis
â””â”€â”€ Fotos (opcional)
```

---

## 13. CHANGELOG

| VersÃ£o | Data | AlteraÃ§Ãµes |
|--------|------|------------|
| 1.0 | Fev/2026 | VersÃ£o inicial do VITRÃšVIO |
| 2.0 | Fev/2026 | UserHealthProfile completo, Plano de Treino, Plano Alimentar, Chat, AnÃ¡lise de Risco, Insights Contextuais |

---

**VITRÃšVIO - Coach IA do VITRU IA v2.0**  
*Inspirado em Marcus Vitruvius Pollio â€¢ AnÃ¡lise â€¢ Treino â€¢ Dieta â€¢ PersonalizaÃ§Ã£o Total*